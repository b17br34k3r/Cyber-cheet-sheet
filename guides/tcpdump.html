<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tcpdump Guide - Cybersecurity Cheat Sheet</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../guide-styles.css">
</head>
<body>
    <div class="guide-container">
        <header class="guide-header">
            <h1>tcpdump: Command-Line Packet Analyzer</h1>
            <p>Master Network Traffic Analysis from the Terminal</p>
            <a href="../index.html" class="back-link">&larr; Back to Cheat Sheet</a>
        </header>

        <main class="guide-content">
            <section id="introduction">
                <h2>What is tcpdump?</h2>
                <p>tcpdump is a powerful command-line packet analyzer that allows you to capture and analyze network traffic. It's one of the most widely used network troubleshooting and security analysis tools, available on most Unix-like systems. tcpdump can capture packets from network interfaces and display them in real-time or save them to files for later analysis.</p>
            </section>

            <section id="installation">
                <h2>Installation & Setup</h2>
                <div class="command-block">
                    <h3>Linux Installation</h3>
                    <pre><code># Ubuntu/Debian
sudo apt update && sudo apt install tcpdump

# CentOS/RHEL
sudo yum install tcpdump

# Arch Linux
sudo pacman -S tcpdump</code></pre>
                </div>
                <div class="command-block">
                    <h3>macOS Installation</h3>
                    <pre><code># Pre-installed on macOS
tcpdump --version

# Or install via Homebrew
brew install tcpdump</code></pre>
                </div>
                <div class="command-block">
                    <h3>Windows Alternative</h3>
                    <pre><code># Use WinDump (Windows port of tcpdump)
# Download from: https://www.winpcap.org/windump/

# Or use WSL with Linux tcpdump
wsl sudo apt install tcpdump</code></pre>
                </div>
            </section>

            <section id="basic-usage">
                <h2>Basic Usage & Syntax</h2>
                <div class="command-block">
                    <h3>Command Structure</h3>
                    <pre><code># Basic syntax
sudo tcpdump [options] [filter expression]

# Capture all traffic on default interface
sudo tcpdump

# Capture on specific interface
sudo tcpdump -i eth0

# Capture with verbose output
sudo tcpdump -v

# Capture and save to file
sudo tcpdump -w capture.pcap</code></pre>
                </div>
                <div class="command-block">
                    <h3>Common Options</h3>
                    <pre><code># Interface selection
-i interface    # Specify interface (eth0, wlan0, any)

# Output options
-v              # Verbose output
-vv             # More verbose
-vvv            # Maximum verbosity
-n              # Don't resolve hostnames
-nn             # Don't resolve hostnames or ports

# Packet count
-c count        # Capture specified number of packets

# File operations
-w file         # Write packets to file
-r file         # Read packets from file</code></pre>
                </div>
            </section>

            <section id="capture-filters">
                <h2>Capture Filters</h2>
                <div class="command-block">
                    <h3>Host Filters</h3>
                    <pre><code># Capture traffic to/from specific host
sudo tcpdump host 192.168.1.100

# Capture traffic from specific source
sudo tcpdump src host 192.168.1.100

# Capture traffic to specific destination
sudo tcpdump dst host 192.168.1.100

# Multiple hosts
sudo tcpdump host 192.168.1.100 or host 192.168.1.200</code></pre>
                </div>
                <div class="command-block">
                    <h3>Port Filters</h3>
                    <pre><code># Capture traffic on specific port
sudo tcpdump port 80

# Source port
sudo tcpdump src port 80

# Destination port
sudo tcpdump dst port 443

# Port range
sudo tcpdump portrange 80-443

# Multiple ports
sudo tcpdump port 80 or port 443</code></pre>
                </div>
                <div class="command-block">
                    <h3>Protocol Filters</h3>
                    <pre><code># TCP traffic only
sudo tcpdump tcp

# UDP traffic only
sudo tcpdump udp

# ICMP traffic only
sudo tcpdump icmp

# ARP traffic
sudo tcpdump arp

# IPv6 traffic
sudo tcpdump ip6</code></pre>
                </div>
            </section>

            <section id="advanced-filters">
                <h2>Advanced Filtering</h2>
                <div class="command-block">
                    <h3>Network Filters</h3>
                    <pre><code># Capture traffic from/to network
sudo tcpdump net 192.168.1.0/24

# Source network
sudo tcpdump src net 10.0.0.0/8

# Destination network
sudo tcpdump dst net 172.16.0.0/12</code></pre>
                </div>
                <div class="command-block">
                    <h3>Complex Filters</h3>
                    <pre><code># HTTP traffic (port 80)
sudo tcpdump 'tcp port 80 and (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)'

# SSH traffic with specific host
sudo tcpdump 'host 192.168.1.100 and port 22'

# Non-SSH traffic
sudo tcpdump 'not port 22'

# TCP SYN packets
sudo tcpdump 'tcp[tcpflags] & tcp-syn != 0'

# TCP RST packets
sudo tcpdump 'tcp[tcpflags] & tcp-rst != 0'</code></pre>
                </div>
                <div class="command-block">
                    <h3>Packet Size Filters</h3>
                    <pre><code># Packets larger than 1000 bytes
sudo tcpdump 'greater 1000'

# Packets smaller than 100 bytes
sudo tcpdump 'less 100'

# Specific packet length
sudo tcpdump 'len = 64'</code></pre>
                </div>
            </section>

            <section id="output-analysis">
                <h2>Output Analysis</h2>
                <div class="command-block">
                    <h3>Understanding Output Format</h3>
                    <pre><code># Standard output format:
# timestamp src > dst: flags data-seqno ack window urgent options

# Example:
# 10:30:45.123456 192.168.1.100.12345 > 192.168.1.200.80: Flags [S], seq 123456789, win 65535, options [mss 1460]

# Components:
# - timestamp: When packet was captured
# - src: Source IP and port
# - dst: Destination IP and port
# - flags: TCP flags (S=SYN, A=ACK, F=FIN, R=RST, P=PSH, U=URG)
# - seq: Sequence number
# - ack: Acknowledgment number
# - win: Window size</code></pre>
                </div>
                <div class="command-block">
                    <h3>Hex and ASCII Output</h3>
                    <pre><code># Show packet contents in hex
sudo tcpdump -x

# Show packet contents in hex and ASCII
sudo tcpdump -X

# Show both link-level and IP headers
sudo tcpdump -xx

# Absolute sequence numbers
sudo tcpdump -S</code></pre>
                </div>
            </section>

            <section id="file-operations">
                <h2>File Operations</h2>
                <div class="command-block">
                    <h3>Saving Captures</h3>
                    <pre><code># Save to pcap file
sudo tcpdump -w capture.pcap

# Save with timestamp in filename
sudo tcpdump -w capture_$(date +%Y%m%d_%H%M%S).pcap

# Rotate files by size (100MB)
sudo tcpdump -w capture.pcap -C 100

# Rotate files by count (keep 10 files)
sudo tcpdump -w capture.pcap -C 100 -W 10</code></pre>
                </div>
                <div class="command-block">
                    <h3>Reading Captures</h3>
                    <pre><code># Read from pcap file
tcpdump -r capture.pcap

# Read with filters
tcpdump -r capture.pcap 'host 192.168.1.100'

# Read and display timestamps
tcpdump -r capture.pcap -t

# Read and show packet numbers
tcpdump -r capture.pcap -#</code></pre>
                </div>
            </section>

            <section id="practical-examples">
                <h2>Practical Examples</h2>
                <div class="command-block">
                    <h3>Web Traffic Analysis</h3>
                    <pre><code># Capture HTTP traffic
sudo tcpdump -i any -s 0 -A 'tcp port 80'

# Capture HTTPS handshakes
sudo tcpdump -i any 'tcp port 443 and tcp[tcpflags] & tcp-syn != 0'

# Monitor DNS queries
sudo tcpdump -i any -s 0 'udp port 53'</code></pre>
                </div>
                <div class="command-block">
                    <h3>Security Monitoring</h3>
                    <pre><code># Detect port scans (SYN packets to multiple ports)
sudo tcpdump -i any 'tcp[tcpflags] & tcp-syn != 0 and tcp[tcpflags] & tcp-ack = 0'

# Monitor failed connections (RST packets)
sudo tcpdump -i any 'tcp[tcpflags] & tcp-rst != 0'

# Capture ARP traffic (potential ARP spoofing)
sudo tcpdump -i any arp</code></pre>
                </div>
                <div class="command-block">
                    <h3>Network Troubleshooting</h3>
                    <pre><code># Monitor specific connection
sudo tcpdump -i any 'host 192.168.1.100 and port 22'

# Check for retransmissions
sudo tcpdump -i any -S 'tcp[tcpflags] & tcp-syn = 0'

# Monitor broadcast traffic
sudo tcpdump -i any broadcast</code></pre>
                </div>
            </section>

            <section id="performance-tips">
                <h2>Performance & Optimization</h2>
                <div class="command-block">
                    <h3>Capture Optimization</h3>
                    <pre><code># Use specific interface instead of 'any'
sudo tcpdump -i eth0

# Limit snapshot length for better performance
sudo tcpdump -s 96  # Capture only first 96 bytes

# Use buffer size option
sudo tcpdump -B 4096  # 4MB buffer

# Disable name resolution for speed
sudo tcpdump -nn</code></pre>
                </div>
                <div class="command-block">
                    <h3>Memory Management</h3>
                    <pre><code># Limit capture count
sudo tcpdump -c 1000

# Use file rotation to prevent large files
sudo tcpdump -w capture.pcap -C 50 -W 5

# Monitor memory usage
sudo tcpdump -i any -s 0 -w /dev/null &
ps aux | grep tcpdump</code></pre>
                </div>
            </section>

            <section id="integration">
                <h2>Integration with Other Tools</h2>
                <div class="command-block">
                    <h3>Wireshark Integration</h3>
                    <pre><code># Capture with tcpdump, analyze with Wireshark
sudo tcpdump -w capture.pcap -i any
wireshark capture.pcap

# Real-time pipe to Wireshark
sudo tcpdump -i any -w - | wireshark -k -i -</code></pre>
                </div>
                <div class="command-block">
                    <h3>Script Integration</h3>
                    <pre><code>#!/bin/bash
# Monitor and alert on suspicious traffic

sudo tcpdump -i any -l 'tcp[tcpflags] & tcp-syn != 0' | \
while read line; do
    echo "$(date): Potential scan detected: $line"
    # Add alerting logic here
done</code></pre>
                </div>
            </section>

            <section id="tips">
                <h2>Pro Tips & Best Practices</h2>
                <ul>
                    <li><strong>Use sudo:</strong> Root privileges required for packet capture</li>
                    <li><strong>Be specific with filters:</strong> Reduce noise and improve performance</li>
                    <li><strong>Save important captures:</strong> Use -w option for later analysis</li>
                    <li><strong>Monitor interface status:</strong> Ensure interface is up and has traffic</li>
                    <li><strong>Use appropriate snapshot length:</strong> -s 0 for full packets, smaller values for headers only</li>
                    <li><strong>Combine with other tools:</strong> Use with Wireshark, awk, grep for analysis</li>
                    <li><strong>Understand your network:</strong> Know normal traffic patterns to spot anomalies</li>
                    <li><strong>Use time-based captures:</strong> Capture during specific time windows</li>
                </ul>
            </section>

            <section id="troubleshooting">
                <h2>Common Issues & Troubleshooting</h2>
                <div class="command-block">
                    <h3>Permission Issues</h3>
                    <pre><code># Add user to pcap group (Ubuntu/Debian)
sudo usermod -a -G pcap $USER

# Set capabilities (alternative to sudo)
sudo setcap cap_net_raw,cap_net_admin=eip /usr/bin/tcpdump</code></pre>
                </div>
                <div class="command-block">
                    <h3>Interface Issues</h3>
                    <pre><code># List available interfaces
tcpdump -D

# Check interface status
ip link show

# Bring interface up
sudo ip link set eth0 up</code></pre>
                </div>
            </section>

            <section id="legal-disclaimer">
                <h2>Legal Disclaimer</h2>
                <div class="command-block">
                    <p><strong>WARNING:</strong> tcpdump should only be used for:</p>
                    <ul>
                        <li>Monitoring your own network traffic</li>
                        <li>Authorized network troubleshooting and analysis</li>
                        <li>Educational purposes in controlled environments</li>
                        <li>Security testing with proper authorization</li>
                    </ul>
                    <p>Unauthorized packet capture and network monitoring may violate privacy laws and organizational policies. Always obtain proper authorization before monitoring network traffic.</p>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
